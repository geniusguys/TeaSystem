<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.test.dao.UserDao">

	<select id="findUser" parameterType="com.test.domain.User" resultType="com.test.domain.User">

		select * from userinfo
		<where>
			<if test="user_name!=null">
				and user_name=#{user_name}
			</if>
			<if test="user_passwod!=null">
				and user_passwod=#{user_passwod}
			</if>
		</where>
	</select>
	
	
	
	<insert id="addUser" parameterType="com.test.domain.User" >
	  insert into userinfo (user_name,user_passwod,user_sex,user_phone,user_rank,user_info)
	  				 values(#{user_name},#{user_passwod},#{user_sex},#{user_phone},#{user_rank},#{user_info})
	
	</insert>
	
	
    <select id="findAllUser"  resultType="com.test.domain.User">
	select * from userinfo
	</select>
	
	
	
	
   <select id="findIdByUsername"  resultType="com.test.domain.User">
	   select * from user 
	   <where>
	       <if test="username!=null">
				and username=#{username}
			</if>
	   </where>
   </select>
   
   
    <select id="findUserByUsername"  resultType="com.test.domain.User">
	   select * from userinfo 
	   <where>
	       <if test="user_name!=null">
				and user_name=#{user_name}
			</if>
	   </where>
   </select>
   
   
   <!-- 修改用户信息 -->
   <update id="updateUserById">
    update userinfo
    <set>
	    <if test="user_name!=null">
	    	 user_name=#{user_name}
	    </if>
	     <if test="user_passwod!=null">
	    	, user_passwod=#{user_passwod}
	    </if>
	     <if test="user_sex!=null">
	    	, user_sex=#{user_sex}
	    </if>
	     <if test="user_phone!=null">
	    	, user_phone=#{user_phone}
	    </if>
	     <if test="user_rank!=null">
	    	, user_rank=#{user_rank}
	    </if>
		<if test="user_info!=null">
	    	, user_info=#{user_info}
	    </if>
    </set>
     <where>
		    <if test="user_id!=null">
		    	and user_id = #{user_id}
		    </if>
	</where>
   
   </update>
   
   
 <!-- 修改用户密码 -->
    <update id="updatepassword">
    update user 
    <set>
	    <if test="username!=null">
	    	 password=#{password}
	    </if>

    </set>
     <where>
		    <if test="username!=null">
		    	and username = #{username}
		    </if>
	</where>
   
   </update>
   
    <!-- 根据id查询返回user -->
    <select id="selectUserById" parameterType="int" resultType="com.test.domain.User">
    select * from userinfo
    <where>
	    <if test="_parameter!=null">
	    user_id = #{_parameter,jdbcType=INTEGER}  
	    </if>
    </where>
    
    </select>
    
     <!-- 根据关键字 key 查询返回user -->
    <select id="selectUserByKey" parameterType="int" resultType="com.test.domain.User">
    select * from userinfo
    <where>
	    <if test="_parameter!=null">
	    user_name  like '%${_parameter}%' 
	    </if>
	    <if test="_parameter!=null">
	    or  user_phone like '%${_parameter}%' 
	    </if>
	    <if test="_parameter!=null">
	    or  user_rank like '%${_parameter}%' 
	    </if>
    </where>
    
    </select>
   
   <delete id="DeleteUserById" parameterType="int">
   		delete from userinfo
   		<where>
   			<if test="_parameter!=null">
   					user_id = #{_parameter}
   			</if>
   		</where>
   </delete>
   
   <!-- 重置密码  begin -->
   <update id="UpdatePasswordUserByIds"  parameterType="int">
   		update user 
   		<set>
   		password = '123456'
   		<where>
   		    <foreach collection="array" item="chek_value" open="userid in ("
	            separator="," close=")">
	   		  #{chek_value}
	   		</foreach>
   		</where>
   		</set>
   		
   
   </update>
   
   <!-- 重置密码  end -->
   
  <delete id="ChooseUserToDeleteByIds"  parameterType="int">
     delete from user
     <where>
           <foreach collection="array" item="chek_value" open="userid in ("
	            separator="," close=")">
	   		  #{chek_value}
	   	   </foreach>
     
     </where>
  
  </delete> 
  
  
  <select id="SereachUserByRole" parameterType="String" resultType="com.test.domain.User">
  		select * from user
  		<where>
	       <if test="_parameter!=null">
				and role like '%${_parameter}%' 
			</if>
	   </where>

  
  </select>
  
  
  
  
  <!-- 选手操作  -->
  
  
	<select id="selectPlayerAll"  resultType="com.test.domain.Player">
	select * from playerinfo
	</select>
  
    <insert id="addPlayer" parameterType="com.test.domain.Player" >
	  insert into playerinfo (player_name,player_sex,player_img,player_title,player_type,player_favorite,
	              player_phone,player_birthday,player_address,player_email,player_info)
	  
	   values(#{player_name},#{player_sex},#{player_img},#{player_title},#{player_type},#{player_favorite},
	          #{player_phone},#{player_birthday},#{player_address},#{player_email},#{player_info})
	</insert>
	
	 <select id="findPlayer"  resultType="com.test.domain.User">
	 select * from userinfo
	 </select>
	
	
	 <select id="findAllPlayer"  resultType="com.test.domain.Player">
	 select * from playerinfo
	 </select>
	 
	  
    <select id="selectPlayerById" parameterType="int" resultType="com.test.domain.Player">
    select * from playerinfo
    <where>
	    <if test="_parameter!=null">
	    player_id = #{_parameter,jdbcType=INTEGER}  
	    </if>
    </where>
    
    </select>
	 
   <!-- 修改用户信息 -->
   <update id="updatePlayerById">
    update playerinfo
    <set>
	    <if test="player_name!=null">
	    	 player_name=#{player_name}
	    </if>
	     
	     <if test="player_title!=null">
	    	, player_title=#{player_title}
	    </if>
	     <if test="player_sex!=null">
	    	, player_sex=#{player_sex}
	    </if>
	     <if test="player_phone!=null">
	    	, player_phone=#{player_phone}
	    </if>
		<if test="player_birthday!=null">
	    	, player_birthday=#{player_birthday}
	    </if>
	    <if test="player_email!=null">
	    	, player_email=#{player_email}
	    </if>
	     <if test="player_info!=null">
	    	, player_info=#{player_info}
	    </if>
    </set>
     <where>
		    <if test="player_id!=null">
		    	and player_id = #{player_id}
		    </if>
	</where>
   
   </update>
   
   
    <delete id="deletePlayerById" parameterType="int">
   		delete from playerinfo
   		<where>
   			<if test="_parameter!=null">
   					player_id = #{_parameter}
   			</if>
   		</where>
   </delete>
   
   
   
     <!-- 根据关键字 key 查询返回 playerlist -->
    <select id="selectPlayerByKey" parameterType="int" resultType="com.test.domain.Player">
    select * from playerinfo
    <where>
	    <if test="_parameter!=null">
	    player_name  like '%${_parameter}%' 
	    </if>
	    <if test="_parameter!=null">
	    or  player_phone like '%${_parameter}%' 
	    </if>
	    <if test="_parameter!=null">
	    or  player_email like '%${_parameter}%' 
	    </if>
    </where>
    
    </select>
    
    
    <select id="selectPlayer1ByName" parameterType="String" resultType="com.test.domain.Player">
  		select * from playerinfo
  		<where>
	       <if test="_parameter!=null">
				and player_name like '${_parameter}' 
			</if>
	   </where>
	    </select>
	   
	   <select id="selectPlayer2ByName" parameterType="String" resultType="com.test.domain.Player">
  		select * from playerinfo
  		<where>
	       <if test="_parameter!=null">
				and player_name like '${_parameter}' 
			</if>
	   </where>

  
  </select>
  
    
    
    
     <select id="selectPlayerTiteByName" parameterType="String" resultType="com.test.domain.Player">
  		select * from playerinfo
  		<where>
	       <if test="_parameter!=null">
				and player_name = #{_parameter}
			</if>
	   </where>

  </select>
  <!-- 配对操作 -->
  
  	<insert id="addBattle" parameterType="com.test.domain.Battle" >
	  insert into battleinfo (player1,player2,player1_title,player2_title)
	  				 values(#{player1},#{player2},#{player1_title},#{player2_title})
	
	</insert>
	
	<select id="selectBattleAll"  resultType="com.test.domain.Battle">
		select * from battleinfo
	</select>
	
	
   <select id="selectBattleById" parameterType="int" resultType="com.test.domain.Battle">
    select * from battleinfo
    <where>
	    <if test="_parameter!=null">
	    contest_id = #{_parameter,jdbcType=INTEGER}  
	    </if>
    </where>
    
    </select>
    
     <update id="updateBattle">
    update battleinfo
    <set>
	    <if test="player1!=null">
	    	 player1=#{player1}
	    </if>
	     <if test="player2!=null">
	    	, player2=#{player2}
	    </if>
	     <if test="player1_title!=null">
	    	, player1_title=#{player1_title}
	    </if>
	     <if test="player2_title!=null">
	    	, player2_title=#{player2_title}
	    </if>
	     <if test="player1_ticket!=null">
	    	, player1_ticket=#{player1_ticket}
	    </if>
		<if test="player2_ticket!=null">
	    	, player2_ticket=#{player2_ticket}
	    </if>
	    
	    <if test="player1_judge!=null">
	    	, player1_judge=#{player1_judge}
	    </if>
	     <if test="player2_judge!=null">
	    	, player2_judge=#{player2_judge}
	    </if>
	     <if test="player1_totalscore!=null">
	    	, player1_totalscore=#{player1_totalscore}
	    </if>
		<if test="player2_totalscore!=null">
	    	, player2_totalscore=#{player2_totalscore}
	    </if>
    </set>
     <where>
		    <if test="contest_id!=null">
		    	and contest_id = #{contest_id}
		    </if>
	</where>
   
   </update>
   
   <!-- 查询所有 battle信息-->
   <select id="SelectAll_Battle"  resultType="com.test.domain.Battle">
	select * from battleinfo
	</select>
   
   
    <update id="updatePlayer1_ticket">
    update battleinfo
    <set>	    
	    	 player1_ticket = player1_ticket+1
  
    </set>
     <where>
		    <if test="contest_id!=null">
		    	and contest_id = #{contest_id}
		    </if>
	</where>
   
   </update>
   
   <update id="updatePlayer2_ticket">
    update battleinfo
    <set>	    
	    	 player2_ticket = player2_ticket+1
  
    </set>
     <where>
		    <if test="contest_id!=null">
		    	and contest_id = #{contest_id}
		    </if>
	</where>
   
   </update>
   
   
   <delete id="deleteBattleById" parameterType="int">
   		delete from battleinfo
   		<where>
   			<if test="_parameter!=null">
   					contest_id = #{_parameter}
   			</if>
   		</where>
   </delete>
   
   
   
   
   
   
     
   <!-- 查询所有 contest 信息-->
   <select id="SelectAll_Contest"  resultType="com.test.domain.Contest">
	select * from contestinfo
	</select>
   
   
   
   
  <update id="updateContestSubmit">
    	update contestinfo
    <set>	    
	     <if test="contest_name!=null">
	    	 contest_name=#{contest_name}
	    </if>
	     <if test="contest_site!=null">
	    	, contest_site=#{contest_site}
	    </if>
	     <if test="contest_time!=null">
	    	, contest_time=#{contest_time}
	    </if>
	     <if test="contest_des!=null">
	    	 ,contest_des=#{contest_des}
	    </if>
	     <where>
		    <if test="battle_id!=null">
		    	and battle_id = #{battle_id}
		    </if>
	</where>
	    
  
    </set>
    
   </update> 
   
   <insert id="addContest" parameterType="com.test.domain.Contest" >
	  insert into contestinfo (contest_name,contest_site,contest_time,contest_des)
	  				 values(#{contest_name},#{contest_site},#{contest_time},#{contest_des})
	
	</insert>
   
   
   
    <select id="selectContestById" parameterType="int" resultType="com.test.domain.Contest">
    select * from contestinfo
    <where>
	    <if test="_parameter!=null">
	    battle_id = #{_parameter,jdbcType=INTEGER}  
	    </if>
    </where>
    
    </select>
   
	 <delete id="deleteContestById" parameterType="int">
   		delete from contestinfo
   		<where>
   			<if test="_parameter!=null">
   					battle_id = #{_parameter}
   			</if>
   		</where>
   </delete>
   
   
    <!-- 根据关键字 key 查询返回contest -->
    <select id="selectContestByKey" parameterType="int" resultType="com.test.domain.Contest">
    select * from contestinfo
    <where>
	    <if test="_parameter!=null">
	    contest_name  like '%${_parameter}%' 
	    </if>
	    <if test="_parameter!=null">
	    or  contest_site like '%${_parameter}%' 
	    </if>
	    <if test="_parameter!=null">
	    or  contest_des like '%${_parameter}%' 
	    </if>
    </where>
    
    </select>
   
   
   
    <update id="updateContestStateById">
    	update contestinfo
    <set>	    
	    
	    	 contest_state ='checked'
	    
	     
	     <where>
		    <if test="_parameter!=null">
		    	and battle_id = #{_parameter}
		    </if>
		</where>
	    
  
    </set>
    
   </update> 
   

   
    <insert id="addVoteIntoDB" parameterType="com.test.domain.Votedes" >
	  insert into votedes (contest_id,battle_id,user_id,player_id,ticket)
	  
	   values(#{contest_id},#{battle_id},#{user_id},#{player_id},#{ticket})
	</insert>
	
	
	
    <select id="selectAllVote"  resultType="com.test.domain.Votedes">
	select * from votedes
	</select>
   
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</mapper>